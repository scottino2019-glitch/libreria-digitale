<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸ“š La Tua Biblioteca Digitale</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/epubjs/dist/epub.min.js"></script>

<style>
body {
  background: linear-gradient(135deg, #f5deb3, #deb887);
  font-family: 'Georgia', serif;
}
.book-card {
  background-color: #fff8dc;
  border-radius: 12px;
  padding: 1rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s;
}
.book-card:hover {
  transform: translateY(-5px);
}
#reader-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: white;
  z-index: 9999;
  display: none;
  flex-direction: column;
}
#reader-container {
  flex: 1;
  overflow: auto;
}
</style>
</head>

<body class="min-h-screen p-4">

<!-- Autenticazione -->
<div id="auth-section" class="max-w-sm mx-auto bg-white rounded-lg shadow-lg p-6">
  <h1 class="text-2xl font-bold text-center mb-4">ðŸ“š La Tua Biblioteca Digitale</h1>
  <input id="email" type="email" placeholder="Email" class="w-full mb-2 p-2 border rounded">
  <input id="password" type="password" placeholder="Password" class="w-full mb-4 p-2 border rounded">
  <div class="flex justify-between">
    <button id="login-btn" class="bg-green-600 text-white px-4 py-2 rounded">Accedi</button>
    <button id="register-btn" class="bg-blue-600 text-white px-4 py-2 rounded">Registrati</button>
  </div>
  <div id="auth-message" class="mt-4 text-center text-sm text-gray-700"></div>
</div>

<!-- Biblioteca -->
<div id="library-section" class="hidden max-w-5xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <input id="search-bar" type="text" placeholder="Cerca libro..." class="p-2 border rounded w-2/3">
    <div class="flex gap-2">
      <input id="file-upload" type="file" class="hidden" />
      <button id="add-book-btn" class="bg-blue-600 text-white px-4 py-2 rounded">ðŸ“¤ Aggiungi Libro</button>
      <button id="logout-btn" class="bg-red-600 text-white px-4 py-2 rounded">ðŸšª Logout</button>
    </div>
  </div>
  <div id="books-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
</div>

<!-- Lettore a schermo intero -->
<div id="reader-overlay" class="flex">
  <div class="bg-gray-200 p-2 flex justify-between items-center">
    <span class="font-bold">ðŸ“– Lettura</span>
    <button id="close-reader" class="bg-red-500 text-white px-3 py-1 rounded">Chiudi</button>
  </div>
  <div id="reader-container"></div>
</div>

<script>
// Configurazione Supabase
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://ipdhzwkyzvpwtcoekhog.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZGh6d2t5enZwd3Rjb2VraG9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NDYyNzMsImV4cCI6MjA3MDMyMjI3M30.50O7BW_34dD9fcza9zDi5WuhW-r9EVinopMLOnhqQtA"
);

let userId = null;

// Fetch libri
async function fetchBooks(search = "") {
  let query = supabaseClient
    .from("books")
    .select("*")
    .eq("user_id", userId)
    .order("title", { ascending: true });

  if (search) {
    query = query.ilike("title", `%${search}%`);
  }

  const { data, error } = await query;
  if (error) {
    console.error(error);
    return;
  }
  renderBooks(data);
}

// Render libri
function renderBooks(books) {
  const container = document.getElementById("books-list");
  if (!books.length) {
    container.innerHTML = `<div class="text-center text-gray-50
